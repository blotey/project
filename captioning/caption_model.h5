from tensorflow.keras.applications import InceptionV3
from tensorflow.keras.models import Model
from tensorflow.keras.layers import Dense, Embedding, LSTM, Add

# Build a basic captioning model structure
encoder = InceptionV3(weights='imagenet')
encoder = Model(encoder.input, encoder.layers[-2].output)

inputs1 = tf.keras.Input(shape=(2048,))
fe1 = Dense(256, activation='relu')(inputs1)
inputs2 = tf.keras.Input(shape=(34,))
se1 = Embedding(10000, 256, mask_zero=True)(inputs2)
se2 = LSTM(256)(se1)
decoder1 = Add()([fe1, se2])
decoder2 = Dense(256, activation='relu')(decoder1)
outputs = Dense(10000, activation='softmax')(decoder2)
caption_model = Model(inputs=[inputs1, inputs2], outputs=outputs)
caption_model.save('captioning/caption_model.h5')
